<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Securely and safely escape HTML, HTML attributes, JavaScript, CSS, and URLs"> 

    
    
    <meta name="docsearch:version" content="latest">
    <meta name="docsearch:language" content="en">
    <meta name="docsearch:component" content="laminas-escaper">

    <link rel="canonical" href="https://docs.laminas.dev/laminas-escaper/theory-of-operation/">
    <link rel="shortcut icon" href="https://docs.laminas.dev/img/trademark-laminas-foundation-rgb.svg">

    <title>Theory of Operation - laminas-escaper - Laminas Docs</title>

    <link rel="stylesheet" href="https://docs.laminas.dev/css/styles.css">
    
</head>
<body id="page-top" class="components" data-spy="scroll" data-target=".toc" data-offset="20">

    
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        
        <a class="logo-link navbar-brand" href="https://getlaminas.org/" data-tooltip data-placement="bottom" title="Go to the Laminas homepage">
            <img src="https://docs.laminas.dev/img/laminas-foundation-white.svg" height="28" alt="Laminas">
        </a>
        <a class="navbar-title" href="https://docs.laminas.dev/" data-tooltip data-placement="bottom" title="Go to the Laminas Documentation">
            Documentation
        </a>

        
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <div class="dropdown sub-project-selector">
                        <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false">
                            All Docs
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a href="https://docs.mezzio.dev/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-mezzio-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Mezzio</strong><br>
                                        PSR-15 Middleware in Minutes
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.laminas.dev/components/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-components-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Components</strong><br>
                                        Components for Enterprise Applications
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.laminas.dev/mvc" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-mvc-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>MVC</strong><br>
                                        MVC for Enterprise Applications
                                    </div>
                                </div>
                            </a>
                            <a href="https://api-tools.getlaminas.org/documentation" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-api-tools-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>API Tools</strong><br>
                                        Build RESTful APIs in Minutes
                                    </div>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item dropdown-item--secondardy" href="https://docs.laminas.dev/migration/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        Migration to Laminas
                                    </div>
                                </div>
                            </a>
                            <a class="dropdown-item dropdown-item--secondardy" href="https://docs.laminas.dev/tutorials/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        Tutorials
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/participate" class="nav-link">Community</a>
                </li>
            </ul>

            
            
                <div class="d-block d-sm-none">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="..">laminas-escaper</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../intro/" class="subnavigation__link">Introduction</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Reference</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Theory of Operation</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../configuration/" class="subnavigation__link">Configuration</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../escaping-html/" class="subnavigation__link">Escaping HTML</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../escaping-html-attributes/" class="subnavigation__link">Escaping HTML Attributes</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../escaping-javascript/" class="subnavigation__link">Escaping Javascript</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../escaping-css/" class="subnavigation__link">Escaping CSS</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../escaping-url/" class="subnavigation__link">Escaping URLs</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="d-block d-sm-none">
                <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</nav>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-8">
                <h1 class="header__title">
                    Components

                    
                        <small class="header__subtitle">laminas-escaper</small>
                    
                </h1>
            </div>

            
            <div class="col-4 text-right">
                
                    

                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/laminas/laminas-escaper/" class="header__link header__link--github" title="Go to repository of laminas-escaper">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-sm-12 content" role="main">
                
                
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#the-problem-with-inconsistent-functionality" class="toc__link nav-link">The Problem with Inconsistent Functionality</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#why-contextual-escaping" class="toc__link nav-link">Why Contextual Escaping?</a>
                    </li>
                
            </ul>
        </div>
    

                

                
                    <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/">Overview</a></li>
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/components/">Components</a></li>

            
                <li class="breadcrumb-item"><a href="..">laminas-escaper</a></li>

                
                    
                        
                        
                            <li class="breadcrumb-item">Reference</li>
                        
                    
                

                <li class="breadcrumb-item active" aria-current="page">Theory of Operation</li>
            
        
    </ol>
</nav>






    
    
        <h2 class="chapter__headline">Reference</h2>
    

    <h1 id="theory-of-operation">Theory of Operation</h1>
<p>laminas-escaper provides methods for escaping output data, dependent on the context
in which the data will be used. Each method is based on peer-reviewed rules and
is in compliance with the current OWASP recommendations.</p>
<p>The escaping follows a well-known and fixed set of encoding rules defined by
OWASP for each key HTML context.  These rules cannot be impacted or negated by
browser quirks or edge-case HTML parsing unless the browser suffers a
catastrophic bug in its HTML parser or Javascript interpreter &mdash; both of
these are unlikely.</p>
<p>The contexts in which laminas-escaper should be used are <strong>HTML Body</strong>, <strong>HTML
Attribute</strong>, <strong>Javascript</strong>, <strong>CSS</strong>, and <strong>URL/URI</strong> contexts.</p>
<p>Every escaper method will take the data to be escaped, make sure it is utf-8
encoded data (or try to convert it to utf-8), perform context-based escaping,
encode the escaped data back to its original encoding, and return the data to
the caller.</p>
<p>The actual escaping of the data differs between each method; they all have their
own set of rules according to which escaping is performed. An example will allow
us to clearly demonstrate the difference, and how the same characters are being
escaped differently between contexts:</p>
<pre class="highlight"><code class="language-php">$escaper = new Laminas\Escaper\Escaper('utf-8');

// &amp;lt;script&amp;gt;alert(&amp;quot;laminas&amp;quot;)&amp;lt;/script&amp;gt;
echo $escaper-&gt;escapeHtml('&lt;script&gt;alert("laminas")&lt;/script&gt;');

// &amp;lt;script&amp;gt;alert&amp;#x28;&amp;quot;laminas&amp;quot;&amp;#x29;&amp;lt;&amp;#x2F;script&amp;gt;
echo $escaper-&gt;escapeHtmlAttr('&lt;script&gt;alert("laminas")&lt;/script&gt;');

// \x3Cscript\x3Ealert\x28\x22laminas\x22\x29\x3C\x2Fscript\x3E
echo $escaper-&gt;escapeJs('&lt;script&gt;alert("laminas")&lt;/script&gt;');

// \3C script\3E alert\28 \22 laminas\22 \29 \3C \2F script\3E
echo $escaper-&gt;escapeCss('&lt;script&gt;alert("laminas")&lt;/script&gt;');

// %3Cscript%3Ealert%28%22laminas%22%29%3C%2Fscript%3E
echo $escaper-&gt;escapeUrl('&lt;script&gt;alert("laminas")&lt;/script&gt;');</code></pre>
<p>More detailed examples will be given in later chapters.</p>
<h2 id="the-problem-with-inconsistent-functionality">The Problem with Inconsistent Functionality</h2>
<p>At present, programmers orient towards the following PHP functions for each
common HTML context:</p>
<ul>
<li><strong>HTML Body</strong>: <code>htmlspecialchars()</code> or <code>htmlentities()</code></li>
<li><strong>HTML Attribute</strong>: <code>htmlspecialchars()</code> or <code>htmlentities()</code></li>
<li><strong>Javascript</strong>: <code>addslashes()</code> or <code>json_encode()</code></li>
<li><strong>CSS</strong>: n/a</li>
<li><strong>URL/URI</strong>: <code>rawurlencode()</code> or <code>urlencode()</code></li>
</ul>
<p>In practice, these decisions appear to depend more on what PHP offers, and if it
can be interpreted as offering sufficient escaping safety, than it does on what
is recommended in reality to defend against XSS. While these functions can
prevent some forms of XSS, they do not cover all use cases or risks and are
therefore insufficient defenses.</p>
<p>Using <code>htmlspecialchars()</code> in a perfectly valid HTML5 unquoted attribute value,
for example, is completely useless since the value can be terminated by a space
(among other things), which is never escaped. Thus, in this instance, we have a
conflict between a widely used HTML escaper and a modern HTML specification,
with no specific function available to cover this use case. While it's tempting
to blame users, or the HTML specification authors, escaping just needs to deal
with whatever HTML and browsers allow.</p>
<p>Using <code>addslashes()</code>, custom backslash escaping, or <code>json_encode()</code> will
typically ignore HTML special characters such as ampersands, which may be used
to inject entities into Javascript. Under the right circumstances, the browser
will convert these entities into their literal equivalents before interpreting
Javascript, thus allowing attackers to inject arbitrary code.</p>
<p>Inconsistencies with valid HTML, insecure default parameters, lack of character
encoding awareness, and misrepresentations of what functions are capable of by
some programmers &mdash; these all make escaping in PHP an unnecessarily
convoluted quest.</p>
<p>To circumvent the lack of escaping methods in PHP, laminas-escaper addresses the
need to apply context-specific escaping in web applications. It implements
methods that specifically target XSS and offers programmers a tool to secure
their applications without misusing other inadequate methods, or using, most
likely incomplete, home-grown solutions.</p>
<h2 id="why-contextual-escaping">Why Contextual Escaping?</h2>
<p>To understand why multiple standardised escaping methods are needed, what
follows are several quick points; they are by no means a complete set of
reasons, however!</p>
<h3 id="html-escaping-of-unquoted-html-attribute-values-still-allows-xss">HTML escaping of unquoted HTML attribute values still allows XSS</h3>
<p>This is probably the best known way to defeat <code>htmlspecialchars()</code> when used on
attribute values, since any space (or character interpreted as a space &mdash;
there are a lot) lets you inject new attributes whose content can't be
neutralised by HTML escaping. The solution (where this is possible) is
additional escaping as defined by the OWASP ESAPI codecs. The point here can be
extended further &mdash; escaping only works if a programmer or designer knows
what they're doing. In many contexts, there are additional practices and gotchas
that need to be carefully monitored since escaping sometimes needs a little
extra help to protect against XSS &mdash; even if that means ensuring all
attribute values are properly double quoted despite this not being required for
valid HTML.</p>
<h3 id="html-escaping-of-css-javascript-or-uris-is-often-reversed-when-passed-to-non-html-interpreters-by-the-browser">HTML escaping of CSS, Javascript or URIs is often reversed when passed to non-HTML interpreters by the browser</h3>
<p>HTML escaping is just that &mdash; it's designed to escape a string for HTML
(i.e. prevent tag or attribute insertion), but not alter the underlying meaning
of the content, whether it be text, Javascript, CSS, or URIs. For that purpose,
a fully HTML-escaped version of any other context may still have its unescaped
form extracted before it's interpreted or executed. For this reason we need
separate escapers for Javascript, CSS, and URIs, and developers or designers
writing templates <strong>must</strong> know which escaper to apply to which context. Of
course, this means you need to be able to identify the correct context before
selecting the right escaper!</p>
<h3 id="dom-based-xss-requires-a-defence-using-at-least-two-levels-of-different-escaping-in-many-cases">DOM-based XSS requires a defence using at least two levels of different escaping in many cases</h3>
<p>DOM-based XSS has become increasingly common as Javascript has taken off in
popularity for large scale client-side coding. A simple example is Javascript
defined in a template which inserts a new piece of HTML text into the DOM. If
the string is only HTML escaped, it may still contain Javascript that will
execute in that context. If the string is only Javascript-escaped, it may
contain HTML markup (new tags and attributes) which will be injected into the
DOM and parsed once the inserting Javascript executes. Damned either way? The
solution is to escape twice &mdash; first escape the string for HTML (make it
safe for DOM insertion), and then for Javascript (make it safe for the current
Javascript context). Nested contexts are a common means of bypassing naive
escaping habits (e.g. you can inject Javascript into a CSS expression within an
HTML attribute).</p>
<h3 id="php-has-no-known-anti-xss-escape-functions-only-those-kidnapped-from-their-original-purposes">PHP has no known anti-XSS escape functions (only those kidnapped from their original purposes)</h3>
<p>A simple example, widely used, is when you see <code>json_encode()</code> used to escape
Javascript, or worse, some kind of mutant <code>addslashes()</code> implementation. These
were never designed to eliminate XSS, yet PHP programmers use them as such. For
example, <code>json_encode()</code> does not escape the ampersand or semi-colon characters
by default. That means you can easily inject HTML entities which could then be
decoded before the Javascript is evaluated in a HTML document. This lets you
break out of strings, add new JS statements, close tags, etc. In other words,
using <code>json_encode()</code> is insufficient and naive. The same, arguably, could be
said for <code>htmlspecialchars()</code> which has its own well known limitations that make
a singular reliance on it a questionable practice.</p>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../intro/">
                    <small class="page-nav__label">Previous</small>
                    <i class="fa fa-chevron-left"></i>
                    Introduction
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../configuration/">
                    <small class="page-nav__label">Next</small>
                    Configuration
                    <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



                
            </div>
            <div class="col-md-3 col-sm-12 sidebar">
                <div class="donation-banner">
    <a href="https://getlaminas.org/support/">
        <h2>Donate</h2>
        <p>Support Laminas Developers Directly</p>
        <img src="https://funding.communitybridge.org/assets/cb-f-horizontal-white.svg">
    </a>
</div>

                
                    <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="..">laminas-escaper</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../intro/" class="subnavigation__link">Introduction</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Reference</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Theory of Operation</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../configuration/" class="subnavigation__link">Configuration</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../escaping-html/" class="subnavigation__link">Escaping HTML</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../escaping-html-attributes/" class="subnavigation__link">Escaping HTML Attributes</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../escaping-javascript/" class="subnavigation__link">Escaping Javascript</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../escaping-css/" class="subnavigation__link">Escaping CSS</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../escaping-url/" class="subnavigation__link">Escaping URLs</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                    
                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h5>Laminas</h5>
                <ul>
                    <li>Laminas Project <a href="https://getlaminas.org/">The new foundation for the community-supported, open source continuation of Zend Framework</a></li>
                    <li>Laminas Components and MVC <a href="https://docs.laminas.dev/">Components and MVC for enterprise applications</a></li>
                    <li>Mezzio <a href="https://docs.mezzio.dev/">PSR-15 middleware in minutes</a></li>
                    <li>Laminas API Tools <a href="https://api-tools.getlaminas.org/">Build RESTful APIs in minutes</a></li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="row">

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Support</h4>
                        <ul class="support__list">
                            <li class="support__list-item">
                                <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://laminas.dev/chat" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://github.com/laminas" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://twitter.com/getlaminas" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/blog/rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                            </li>
                        </ul>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">License</h4>
                        <p>
                            Code licensed under <a
                                href="https://github.com/laminas/laminas-escaper/blob/master/LICENSE.md">BSD 3-Clause</a>.
                        </p>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Copyright</h4>
                        <p>
                            <!--Built with love by the Laminas team with the help of our
                            <a href="https://github.com/laminas/laminas-escaper/graphs/contributors">contributors</a>.<br>-->
                            &copy; 2022 <a href="https://getlaminas.org/">Laminas Project</a> a Series of LF Projects, LLC.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script>
        let base_url = '..',
            project  = "components",
            siteName = 'laminas-escaper';
    </script>
    <script src="https://docs.laminas.dev/js/scripts.js"></script>
    
        <script src="../search/main.js"></script>
    

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in laminas-escaper" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>
</body>


</html>
